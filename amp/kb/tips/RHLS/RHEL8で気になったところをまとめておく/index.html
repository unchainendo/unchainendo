<!DOCTYPE html>
<html ⚡ lang="ja">
    <head>
        

        <meta charset="utf-8" />
        <script async src="https://cdn.ampproject.org/v0.js"></script>
        <title>RHEL8めも | YuKB</title>
        
            <link rel="canonical" href="https://unchainendo.github.io/unchainendo/kb/tips/RHLS/RHEL8%E3%81%A7%E6%B0%97%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%8A%E3%81%8F/" />
        
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />

        
        

        <script type="application/ld+json">
            {
                "@context": "http://schema.org",
                "@type": "NewsArticle",
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": "https:\/\/unchainendo.github.io\/unchainendo\/kb\/tips\/RHLS\/RHEL8%E3%81%A7%E6%B0%97%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%8A%E3%81%8F\/"
                },
                "headline": "RHEL8めも",
                
                "datePublished": "2020-06-29T00:00:00"},
                "author": {
                    "@type": "Person",
                    "name": "UNCHAIN-ENDO"
                },
                "publisher": {
                    "name": "YuKB",
                    "logo": {
                      "@type": "ImageObject",
                      "url": ""
                }
            }
        </script>
        <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
        
        
        
        <style amp-custom>;@font-face{font-family:yu gothic;src:local("Yu Gothic Medium");font-weight:100}@font-face{font-family:yu gothic;src:local("Yu Gothic Medium");font-weight:200}@font-face{font-family:yu gothic;src:local("Yu Gothic Medium");font-weight:300}@font-face{font-family:yu gothic;src:local("Yu Gothic Medium");font-weight:400}@font-face{font-family:yu gothic;src:local("Yu Gothic Bold");font-weight:700}@font-face{font-family:helvetica neue;src:local("Helvetica Neue Regular");font-weight:100}@font-face{font-family:helvetica neue;src:local("Helvetica Neue Regular");font-weight:200}@font-face{font-family:myyugothicm;font-weight:100;src:local("YuGothic-Light"),local("Yu Gothic Light")}@font-face{font-family:myyugothicm;font-weight:200;src:local("YuGothic-Light"),local("Yu Gothic Light")}@font-face{font-family:myyugothicm;font-weight:300;src:local("YuGothic-Regular"),local("Yu Gothic")}@font-face{font-family:myyugothicm;font-weight:400;src:local("YuGothic-Medium"),local("Yu Gothic Medium"),local("YuGothic-Regular")}@font-face{font-family:myyugothicm;font-weight:500;src:local("YuGothic-Medium"),local("Yu Gothic Medium"),local("YuGothic-Regular")}@font-face{font-family:myyugothicm;font-weight:600;src:local("YuGothic-Bold"),local("Yu Gothic")}@font-face{font-family:myyugothicm;font-weight:700;src:local("YuGothic-Bold"),local("Yu Gothic")}@font-face{font-family:myyugothicm;font-weight:800;src:local("YuGothic-Bold"),local("Yu Gothic")}@font-face{font-family:myyugothicm;font-weight:900;src:local("YuGothic-Bold"),local("Yu Gothic")}body{font-family:-apple-system,BlinkMacSystemFont,helvetica neue,biz udpゴシック,BIZ-UDPGothic,ud digi kyokasho n-r,hiragino kaku gothic pron,noto sans jp,MyYuGothicM,Verdana,Meiryo,"m+ 1p",sans-serif;font-feature-settings:"palt" 1}.m-paginator__list-item-link,.m-paginator__list-item-link--current,.m-logo__link,.a-breadcrumbs__list-item-link{text-decoration:none}.chroma{color:#f8f8f2;background-color:#272822;max-height:400px;overflow-y:scroll;overflow-x:scroll;word-wrap:normal;white-space:pre}.chroma .err{color:#960050;background-color:#1e0010}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#66d9ef}.chroma .kc{color:#66d9ef}.chroma .kd{color:#66d9ef}.chroma .kn{color:#f92672}.chroma .kp{color:#66d9ef}.chroma .kr{color:#66d9ef}.chroma .kt{color:#66d9ef}.chroma .na{color:#a6e22e}.chroma .nc{color:#a6e22e}.chroma .no{color:#66d9ef}.chroma .nd{color:#a6e22e}.chroma .ne{color:#a6e22e}.chroma .nf{color:#a6e22e}.chroma .nx{color:#a6e22e}.chroma .nt{color:#f92672}.chroma .l{color:#ae81ff}.chroma .ld{color:#e6db74}.chroma .s{color:#e6db74}.chroma .sa{color:#e6db74}.chroma .sb{color:#e6db74}.chroma .sc{color:#e6db74}.chroma .dl{color:#e6db74}.chroma .sd{color:#e6db74}.chroma .s2{color:#e6db74}.chroma .se{color:#ae81ff}.chroma .sh{color:#e6db74}.chroma .si{color:#e6db74}.chroma .sx{color:#e6db74}.chroma .sr{color:#e6db74}.chroma .s1{color:#e6db74}.chroma .ss{color:#e6db74}.chroma .m{color:#ae81ff}.chroma .mb{color:#ae81ff}.chroma .mf{color:#ae81ff}.chroma .mh{color:#ae81ff}.chroma .mi{color:#ae81ff}.chroma .il{color:#ae81ff}.chroma .mo{color:#ae81ff}.chroma .o{color:#f92672}.chroma .ow{color:#f92672}.chroma .c{color:#75715e}.chroma .ch{color:#75715e}.chroma .cm{color:#75715e}.chroma .c1{color:#75715e}.chroma .cs{color:#75715e}.chroma .cp{color:#75715e}.chroma .cpf{color:#75715e}.chroma .gd{color:#f92672}.chroma .ge{font-style:italic}.chroma .gi{color:#a6e22e}.chroma .gs{font-weight:700}.chroma .gu{color:#75715e}.a-copy-right{display:block;padding:2rem}.a-breadcrumbs__list{flex-wrap:wrap;list-style:none;margin:0;padding:0}.a-breadcrumbs__list-item{display:inline-block;white-space:nowrap}.a-breadcrumbs__list-item-link{font-size:.875rem}.a-breadcrumbs__list-item-link,.a-breadcrumbs__list-item-link:active,.a-breadcrumbs__list-item-link:hover,.a-breadcrumbs__list-item-link:visited{color:#212529}.a-breadcrumbs__list-item-link:hover{color:#0056b3;text-decoration:underline}.a-breadcrumbs__list-item-link-gt{padding-left:.5rem;padding-right:.5rem}.m-logo{padding:2rem}.m-logo__link{font-size:2rem}.m-logo__link,.m-logo__link:active,.m-logo__link:hover,.m-logo__link:visited{color:#212529}.m-global-menu{display:flex}.m-global-menu__navigation{display:flex}.m-global-menu__navigation-list{display:flex;align-items:baseline;padding:0;margin:0;list-style:none}.m-global-menu__navigation-list-item{display:flex;align-items:baseline;margin:0;padding:1rem}.m-global-menu__navigation-list-item-link,.m-global-menu__navigation-list-item-link--active{display:block;font-weight:400}.m-global-menu__navigation-list-item-link,.m-global-menu__navigation-list-item-link--active,.m-global-menu__navigation-list-item-link:active,.m-global-menu__navigation-list-item-link:hover,.m-global-menu__navigation-list-item-link:visited{text-decoration:none;color:#212529}.m-global-menu__navigation-list-item-link--active{font-weight:700}.m-global-menu__navigation-list-item-link--active,.m-global-menu__navigation-list-item-link--active:active,.m-global-menu__navigation-list-item-link--active:hover,.m-global-menu__navigation-list-item-link--active:visited{text-decoration:none;border-bottom:2px solid #212529}.m-global-menu__navigation-list-item-link:hover,.m-global-menu__navigation-list-item-link--active:hover{color:#0056b3}.m-body{display:block;width:100%}.m-global-header{display:flex;align-items:baseline;max-width:1260px;margin-left:auto;margin-right:auto;height:100px}@media screen and (max-width:1024px){.m-global-header{flex-direction:column;align-items:center;height:auto}}.m-main{display:block;max-width:1260px;margin-left:auto;margin-right:auto}.m-main-container{display:flex}@media screen and (max-width:1024px){.m-main-container{flex-direction:column}}.m-content-container{width:auto}.m-aside-container{flex-shrink:0;width:400px}@media screen and (max-width:1024px){.m-aside-container{width:auto}}.m-global-footer{display:block;max-width:1260px;margin-left:auto;margin-right:auto}.m-entry{padding:2rem}.m-entry__breadcrumbs{padding-bottom:2rem}.m-entry__header{padding-bottom:2rem}.m-entry__header-taxonomies{display:flex}.m-entry__header-taxonomies-category{padding-right:1rem}.m-entry__header-taxonomies-category-title-link,.m-entry__header-taxonomies-category-title-link:active,.m-entry__header-taxonomies-category-title-link:hover,.m-entry__header-taxonomies-category-title-link:visited{text-decoration:none;color:#212529}.m-entry__header-taxonomies-category-title-link:hover{color:#0056b3;text-decoration:underline}.m-entry__header-taxonomies-category-title-link::before{font-family:"font awesome 5 free";content:"";-webkit-font-smoothing:antialiased;display:inline-block;text-rendering:auto;line-height:1;font-weight:800;padding-right:5px}.m-entry__header-taxonomies-tags-list{display:flex;list-style:none;padding:0}.m-entry__header-taxonomies-tags-list-item{padding-right:1rem}.m-entry__header-taxonomies-tags-list-item-link,.m-entry__header-taxonomies-tags-list-item-link:active,.m-entry__header-taxonomies-tags-list-item-link:hover,.m-entry__header-taxonomies-tags-list-item-link:visited{text-decoration:none;color:#212529}.m-entry__header-taxonomies-tags-list-item-link:hover{color:#0056b3;text-decoration:underline}.m-entry__header-taxonomies-tags-list-item-link::before{font-family:"font awesome 5 free";content:"";-webkit-font-smoothing:antialiased;display:inline-block;text-rendering:auto;line-height:1;font-weight:800;padding-right:5px}.m-entry__header-title-link,.m-entry__header-title-link:active,.m-entry__header-title-link:hover,.m-entry__header-title-link:visited{text-decoration:none;color:#212529}.m-entry__header-title-link-text{font-size:2rem;padding-top:1rem;padding-bottom:1rem}.m-entry__header-eyecache{padding-top:1rem}.m-entry__header-eyecache-img{width:100%}.m-entry__footer{padding:1rem}.m-entry__footer-sns-buttons{display:flex;justify-content:center;width:100%;padding-bottom:1rem}.m-entry__footer-sns-buttons-icon,.m-entry__footer-sns-buttons-icon-hatebu{display:block;padding-right:1rem;font-size:1.5rem;line-height:1rem}.m-entry__footer-sns-buttons-icon,.m-entry__footer-sns-buttons-icon-hatebu,.m-entry__footer-sns-buttons-icon:active,.m-entry__footer-sns-buttons-icon:hover,.m-entry__footer-sns-buttons-icon:visited{text-decoration:none;color:#212529}.m-entry__footer-sns-buttons-icon:hover,.m-entry__footer-sns-buttons-icon-hatebu:hover{color:#0056b3}.m-entry__footer-sns-buttons-icon-hatebu{position:relative;top:4px;font-family:Verdana;font-weight:700}.m-entry__page-navigation{display:flex;justify-content:center;padding-bottom:2rem}.m-entry__page-navigation-link{padding-right:1rem}.m-entry__page-navigation-link,.m-entry__page-navigation-link:active,.m-entry__page-navigation-link:hover,.m-entry__page-navigation-link:visited{text-decoration:none;color:#212529}.m-entry__page-navigation-link:hover{color:#0056b3}.m-entry__content{line-height:170%}.m-entry__content h2{padding-top:2rem;padding-bottom:1rem}.m-entry__content h3{padding-top:1rem;padding-bottom:1rem}.m-entry__content img{width:100%}.m-entry__content code{background-color:#eee;padding-left:2px;padding-right:2px;font-weight:400;border-radius:4px}.m-entry__content pre{padding:1rem}.m-entry__content .highlight pre code{padding:0;background-color:transparent}.m-entry__content pre code{overflow:auto;word-wrap:normal;white-space:pre}.m-entry__content table{margin:1rem;width:100%;border-collapse:collapse}.m-entry__content table tr th{padding:.5rem;border:1px solid #ccc;background-color:#ccc}.m-entry__content table tr td{padding:.5rem;border:1px solid #ccc}.m-entry__content blockquote{padding:1rem;margin:2rem;border-left:3px solid #ccc}.m-entry__content a[target=_blank]::after{font-family:"font awesome 5 free";content:"";-webkit-font-smoothing:antialiased;display:inline-block;text-rendering:auto;line-height:1;font-weight:800;margin-left:5px;margin-right:3px;display:inline-block}.m-list__breadcrumbs{padding-top:2rem;padding-left:2rem;padding-right:2rem}.m-paginator{padding-left:2rem;padding-right:2rem}.m-paginator__list{display:flex;justify-content:center;list-style:none;margin:0;padding:0}.m-paginator__list-item{display:block;padding:.5rem}.m-paginator__list-item-link,.m-paginator__list-item-link--current,.m-paginator__list-item-link:active,.m-paginator__list-item-link:hover,.m-paginator__list-item-link:visited{color:#212529}.m-paginator__list-item-link:hover,.m-paginator__list-item-link--current:hover{color:#0056b3}.m-paginator__list-item-link--current{font-weight:700}.m-paginator__list-item-link--current,.m-paginator__list-item-link--current:active,.m-paginator__list-item-link--current:hover,.m-paginator__list-item-link--current:visited{text-decoration:none;border-bottom:2px solid #212529}.m-aside-container{padding:1rem}.m-aside-widget,.m-aside-widget__tags,.m-aside-widget__category,.m-aside-widget__profile{padding:1rem}.m-aside-widget__profile-avatar{text-align:center}.m-aside-widget__profile-avatar-img{border-radius:30rem}.m-aside-widget__profile-author{padding:1rem;text-align:center}.m-aside-widget__category-list{list-style:none}.m-aside-widget__category-list-item{padding-bottom:.5rem}.m-aside-widget__category-list-item-link,.m-aside-widget__category-list-item-link:active,.m-aside-widget__category-list-item-link:hover,.m-aside-widget__category-list-item-link:visited{text-decoration:none;color:#212529}.m-aside-widget__category-list-item-link:hover{color:#0056b3;text-decoration:underline}.m-aside-widget__category-list-item-link::before{font-family:"font awesome 5 free";content:"";-webkit-font-smoothing:antialiased;display:inline-block;text-rendering:auto;line-height:1;font-weight:800;padding-right:5px}.m-aside-widget__category>.m-aside-widget__category-list{padding:0}.m-aside-widget__tags-list{list-style:none}.m-aside-widget__tags-list-item{padding-bottom:.5rem}.m-aside-widget__tags-list-item-link,.m-aside-widget__tags-list-item-link:active,.m-aside-widget__tags-list-item-link:hover,.m-aside-widget__tags-list-item-link:visited{text-decoration:none;color:#212529}.m-aside-widget__tags-list-item-link:hover{color:#0056b3;text-decoration:underline}.m-aside-widget__tags-list-item-link::before{font-family:"font awesome 5 free";content:"";-webkit-font-smoothing:antialiased;display:inline-block;text-rendering:auto;line-height:1;font-weight:800;padding-right:5px}.m-aside-widget__tags>.m-aside-widget__tags-list{padding:0}</style>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    </head>
    <body>
        <header class="m-global-header">
            <div class="m-logo">
                <a class="m-logo__link" href="/" >YuKB</a>
            </div>
        </header>
        <main class="m-main">
            <div class="m-main-container">
                <div class="m-content-container">
                    
    <article class="m-entry" >
        <div class="m-entry__header">
            <div class="m-entry__header-category">
                <span class="m-entry__header-category-title">
                    RHLS
                </span>
            </div>
            <div class="m-entry__header-title">
                <a class="m-entry__header-title-link" href="https://unchainendo.github.io/unchainendo/amp/kb/tips/RHLS/RHEL8%E3%81%A7%E6%B0%97%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E3%81%A8%E3%81%93%E3%82%8D%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%8A%E3%81%8F/" >
                    <h1 class="m-entry__header-title-link-text">RHEL8めも</h1>
                </a>
            </div>
            <div class="m-entry__header-date">
                <time>2020/06/29</time>
            </div>

            
            
        </div>
        <div class="m-entry__content">
            <h3 id="はじめに">はじめに</h3>
<p>RHEL8の研修を受講して今更ながら初めて知った情報とか便利機能を書き残しておく。</p>
<h3 id="heading"></h3>
<h4 id="コマンド履歴">コマンド履歴</h4>
<p>いつもviモードで履歴検索かけちゃうので<code>history</code>はほとんど使ったことなかった。</p>
<p><code>history</code>コマンドを実行すると<code>&lt;数字連番&gt; &lt;コマンド&gt;</code>という形で履歴がばーっと表示される。
例えば<code>3</code>のコマンド履歴を再利用したい場合は<code>!3</code>とすれば良い。
<code>!ls</code>とすれば、<code>ls</code>で始まる最後に実行したコマンドを実行できる。</p>
<h4 id="rhel8のパッケージ管理">RHEL8のパッケージ管理</h4>
<p><code>yum</code>に代わって<code>dnf</code>という仕組みになったみたい。
とはいえこれまでどおりyumコマンドは使うことができて、裏でdnfが呼び出される模様。
まだまだyumを使いたいけれど、、徐々に世代交代していくのだろう。</p>
<p>RHEL7と大きく異なるのはリポジトリの考え方。
OptionalとかExtendedみたいなリポジトリはなくなり、<code>BaseOS</code>と<code>AppStream</code>という2つになった。
<code>BaseOS</code>は文字どおりOSとその周辺機能が提供され、EOSも1つ。
一方<code>AppStream</code>の方はWebサーバーとかDBとか開発言語とか、そういったアプリケーションをOSとは分けてバージョン管理できるようになっている。
特定のアプリケーション(例えばhttpd)を構成するパッケージ群はモジュールと呼ばれ、パッケージ管理の新しい単位として使えるみたい。
<code>yum module list</code>って感じで。
更にサポート期間もこのモジュールごとに決められているというのも新しいポイント。
柔軟な分、EOS管理の考え方は少し複雑になってしまうかもしれない。</p>
<h4 id="webコンソール">Webコンソール</h4>
<p>RHELにはWebコンソール管理インタフェースという機能があったらしい。全然知らなかった。
サーバーの管理と監視を行うためのWebベースの管理インタフェースとのこと。
Webコンソールを有効化するには<code>cockpit</code>パッケージをインストールする必要がある。
最小インストール以外は最初からインストールされているとのこと。
<code>yum install cockpit</code>
あとはsystemctlで<code>cockpit.socket</code>サービスをenableして、必要に応じてfirewalldに穴あけする。
<code>systemctl enable cockpit.socket</code>
サービスが起動していればあとはWebブラウザで<code>https://&lt;IPアドレス&gt;:9090</code>を開いて適当なユーザーでログインするだけ。</p>
<p>Webコンソールではユーザーのパスワード管理やパフォーマンス(CPU、メモリ、ディスク、ネットワーク)確認、ログ確認などの管理タスクをGUIで行うことができる。
AIXのSMITに近い感じかな。</p>
<h4 id="ユーザージョブのスケジューリング">ユーザージョブのスケジューリング</h4>
<p>cronはよく触ってきたけれど<code>at</code>、<code>atq</code>は初めて使い方を勉強したのでメモ。
<code>at</code>は単発でコマンドをスケジュールして実行するためのもので、aからzまでの26個のキューにスケジュールを格納できる。
キューはアルファベット順で後ろにいくほど優先度が低くなる。</p>
<p>使い方は<code>at &lt;TIMESPEC&gt;</code>をそのまま実行して対話式にスケジュールしたいコマンドを設定するか、
パイプやリダイレクトでスケジュールしたいコマンドを&quot;&ldquo;文字列として&quot;&ldquo;<code>at &lt;TIMESPEC&gt;</code>に渡してあげれば良い。
cronだと何分後、何日後といった書き方はできないのでatの方が便利なときがあるのかも。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># echoでスケジュールしたいコマンドを文字列として出力してatコマンドにパイプで渡す</span>
$ <span class="nb">echo</span> <span class="s2">&#34;date &gt;&gt; ./test.txt&#34;</span> <span class="p">|</span> at now +3min
warning: commands will be executed using /bin/sh
job <span class="m">1</span> at Thu Mar <span class="m">21</span> 12:30:00 <span class="m">2019</span>

<span class="c1"># atq または at -l でジョブを確認</span>
$ atq
<span class="m">1</span> Thu Mar <span class="m">21</span> 12:30:00 <span class="m">2019</span> a student

<span class="c1"># ジョブ番号1のユーザージョブを削除</span>
$ atrm <span class="m">1</span>
</code></pre></div><p>少し逸れるが<code>watch</code>コマンドってのも初めて知った。
<code>watch &lt;コマンド&gt;</code>とすると指定したコマンドの出力を一定間隔(デフォルト2秒)で更新してくれる。
ただターミナルログには残らないので使い道は限られてしまいそう。
for文+sleepでぶん回したくなったときに思い出すようにしよう。</p>
<h4 id="プロセスの優先度">プロセスの優先度</h4>
<p><code>nice</code>と<code>renice</code>の話。これも仕組みを知っていただけで触ったことはなかった。
niceレベルは<code>-20</code>から<code>19</code>までの40段階で、数字が大きいほど優先度が高い。通常は<code>0</code>。</p>
<p>プロセスの優先度は<code>top</code>または<code>ps</code>で確認できる。
topはnice値(NI列)に対して優先度(PR列)が割り当てられる。
nice値-20が優先度0、nice値19が優先度39といった感じ。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># topコマンドでnice値(NI列)と優先度(PR列)を確認</span>
$ top
top - 03:06:23 up <span class="m">8</span> min,  <span class="m">1</span> user,  load average: 0.00, 0.03, 0.02
Tasks:  <span class="m">93</span> total,   <span class="m">1</span> running,  <span class="m">92</span> sleeping,   <span class="m">0</span> stopped,   <span class="m">0</span> zombie
%Cpu<span class="o">(</span>s<span class="o">)</span>:  0.3 us,  0.0 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.3 si,  0.0 st
MiB Mem :   1829.4 total,   1513.2 free,    137.3 used,    178.9 buff/cache
MiB Swap:   2048.0 total,   2048.0 free,      0.0 used.   1545.3 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    <span class="m">1</span> root      <span class="m">20</span>   <span class="m">0</span>  <span class="m">175868</span>  <span class="m">10420</span>   <span class="m">8112</span> S   0.0   0.6   0:00.79 systemd
    <span class="m">2</span> root      <span class="m">20</span>   <span class="m">0</span>       <span class="m">0</span>      <span class="m">0</span>      <span class="m">0</span> S   0.0   0.0   0:00.00 kthreadd
    <span class="m">3</span> root       <span class="m">0</span> -20       <span class="m">0</span>      <span class="m">0</span>      <span class="m">0</span> I   0.0   0.0   0:00.00 rcu_gp
    <span class="m">4</span> root       <span class="m">0</span> -20       <span class="m">0</span>      <span class="m">0</span>      <span class="m">0</span> I   0.0   0.0   0:00.00 rcu_par_gp

<span class="c1"># psコマンドでnice値を確認 + nice値でソート</span>
$ ps axo pid,comm,nice,cls --sort<span class="o">=</span>-nice
  PID COMMAND          NI CLS
   <span class="m">23</span> khugepaged       <span class="m">19</span>  TS
   <span class="m">22</span> ksmd              <span class="m">5</span>  TS
    <span class="m">1</span> systemd           <span class="m">0</span>  TS
    <span class="m">2</span> kthreadd          <span class="m">0</span>  TS
    <span class="m">7</span> kworker/u2:0-ev   <span class="m">0</span>  TS
    <span class="m">9</span> ksoftirqd/0       <span class="m">0</span>  TS
   <span class="m">10</span> rcu_sched         <span class="m">0</span>  TS
</code></pre></div><p>特に何も指定しなければ親プロセス(コマンドラインならシェル)のniceレベルを継承する。
シェルは通常nice値0なので、そこから生成されるプロセスもnice値は0になる。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># バックグラウンドプロセスを起動</span>
$ sha1sum /dev/zero <span class="p">&amp;</span>
<span class="o">[</span>1<span class="o">]</span> <span class="m">2342</span>

<span class="c1"># 起動したプロセスのnice値は0</span>
$ ps -o pid,ppid,comm,nice <span class="m">2342</span>
  PID  PPID COMMAND          NI
 <span class="m">2342</span>  <span class="m">2093</span> sha1sum           <span class="m">0</span>

<span class="c1"># 親プロセス(シェル)のnice値も0</span>
$ ps -o pid,ppid,comm,nice <span class="m">2093</span>
  PID  PPID COMMAND          NI
 <span class="m">2093</span>  <span class="m">2092</span> bash              <span class="m">0</span>
</code></pre></div><p>niceレベルを変える場合は<code>nice</code>コマンドを使用する。
<code>nice &lt;コマンド&gt;</code>でデフォルトのnice値10でプロセスを起動する。
nice値を指定する場合は<code>nice -n &lt;nice値&gt; &lt;コマンド&gt;</code>とする。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># niceコマンドでバックグラウンドプロセスを起動</span>
$ nice sha1sum /dev/zero <span class="p">&amp;</span>
<span class="o">[</span>1<span class="o">]</span> <span class="m">2361</span>

<span class="c1"># nice値はデフォルトの10</span>
$ ps -o pid,comm,nice <span class="m">2361</span>
  PID COMMAND          NI
 <span class="m">2361</span> sha1sum          <span class="m">10</span>

<span class="c1"># nice値を指定してバックグラウンドプロセスを起動</span>
$ nice -n <span class="m">15</span> sha1sum /dev/zero <span class="p">&amp;</span>
<span class="o">[</span>2<span class="o">]</span> <span class="m">2363</span>

<span class="c1"># 指定したnice値でプロセスが起動している</span>
$ ps -o pid,comm,nice <span class="m">2363</span>
  PID COMMAND          NI
 <span class="m">2363</span> sha1sum          <span class="m">15</span>
</code></pre></div><p>稼働中のプロセスのnice値は<code>renice -n &lt;nice値&gt; &lt;PID&gt;</code>で変更できる。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># nice値10でプロセス起動</span>
$ nice sha1sum /dev/zero <span class="p">&amp;</span>
<span class="o">[</span>1<span class="o">]</span> <span class="m">2417</span>
$ ps -o pid,comm,nice <span class="m">2417</span>
  PID COMMAND          NI
 <span class="m">2417</span> sha1sum          <span class="m">10</span>

<span class="c1"># reniceでnice値を18に変更</span>
$ renice -n <span class="m">18</span> <span class="m">2417</span>
<span class="m">2417</span> <span class="o">(</span>process ID<span class="o">)</span> 従来の優先順位は <span class="m">10</span> で, 新しい優先順位は <span class="m">18</span> です
$ ps -o pid,comm,nice <span class="m">2417</span>
  PID COMMAND          NI
 <span class="m">2417</span> sha1sum          <span class="m">18</span>
</code></pre></div><h4 id="acl設定">ACL設定</h4>
<p><code>setfacl</code>でユーザーやグループを指定したアクセス権の設定ができる。
<code>setfacl -m u:&lt;ユーザー名 or UID&gt;:&lt;パーミッション&gt; &lt;ファイル or ディレクトリ&gt;</code>で設定して
<code>getfacl &lt;ファイル or ディレクトリ&gt;</code>で確認。</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># ihs01ユーザーにすべての権限を付与
$ setfacl -m u:ihs01:rwx test.txt
$ getfacl test.txt
# file: test.txt
# owner: test
# group: test
user::rwx
user:ihs01:rwx
group::rw-
mask::rwx
other::r--
</code></pre></div><h4 id="selinuxについて">SELinuxについて</h4>
<p>SELinuxといえばとりあえず無効化するもの、ってくらいにしか思っていなかったので軽く概要だけメモっておく。</p>
<ul>
<li>SELinuxとは「どのプロセスが、どのファイル、ディレクトリ、ポートにアクセスできるかを決定する、一連のセキュリティルール」を指す。</li>
<li>すべてのファイル、プロセス、ディレクトリ、ポートにはSELinuxコンテキストが付いている。</li>
<li>SELinuxコンテキストとは、あるプロセスがファイル、ディレクトリ、ポートにアクセスできるかどうかを決定するためのポリシーを表すセキュリティラベルのこと。</li>
<li>セキュリティラベルには<code>ユーザー(SELinux User)</code>、<code>役割(Role)</code>、<code>タイプ(Type)</code>、<code>気密度(Level)</code>の4つで構成される。</li>
<li><code>ps</code>、<code>ls</code>などでSELinuxコンテキストを表示するには<code>-Z</code>オプションを使用する。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ ls -lZ /
合計 <span class="m">24</span>
drwxr-xr-x.   <span class="m">4</span> root  root unconfined_u:object_r:default_t:s0   <span class="m">29</span>  8月 <span class="m">12</span> 04:14 app
lrwxrwxrwx.   <span class="m">1</span> root  root system_u:object_r:bin_t:s0            <span class="m">7</span>  8月 <span class="m">12</span>  <span class="m">2018</span> bin -&gt; usr/bin
dr-xr-xr-x.   <span class="m">5</span> root  root system_u:object_r:boot_t:s0        <span class="m">4096</span>  8月 <span class="m">15</span>  <span class="m">2019</span> boot
</code></pre></div><ul>
<li>SELinuxコンテキストは<code>semanage fcontext</code>コマンドで管理し、<code>restorecon</code>コマンドで適用する。(<code>chcon</code>コマンドでも可能)</li>
<li><code>boolean</code>はSELinuxポリシーを個別に有効/無効にできるスイッチとして使える。</li>
<li>SELinuxのログを<code>/var/log/messages</code>に送るには<code>setroubleshoot-server</code>パッケージをインストールする必要がある。</li>
<li><code>sealert</code>コマンドはトラブルシューティングに必要な情報を見やすく表示する。</li>
</ul>
<h4 id="rhel8の新しいストレージ管理stratis">RHEL8の新しいストレージ管理「Stratis」</h4>
<p>デバイス、ボリューム、ファイルシステムといったものはそれぞれ個別に管理していたが
RHEL8からそれらを<code>Stratis</code>という新しいボリューム管理ファイルシステムで管理できるようになったようだ。
ボリューム管理ファイルシステム(&ldquo;<code>Volume-Managing Filesystem(VMFs)</code>)ってのは複数のボリュームをまとめて1つのプールを作り、そこからファイルシステムを作成できる仕組みのようだ。
Stratisのファイルシステムはシンプロとのこと。
感覚的には外部ディスク装置のストレージプールとかボリュームの切り出しに近い。</p>
<p>ブロックデバイス(/dev/sda, /dev/sdb)をまとめたプールを作り、そのプールからファイルシステムを切り出す。
今までPV、VG、LVと順番に作っていたものが「プール」にひとまとめになった感じ。</p>
<p>ストレージまわりは今後絶対使うことになりそうだから環境整備から一通り試してみる。
まずはStratisのインストール。早速<code>AppStream</code>リポジトリを使用する。
<code>BaseOS</code>側だと思いこんで探すのに時間かかってしまった。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1"># stratis-cliとstratisdをインストール</span>
<span class="c1"># yum install stratis-cli stratisd</span>
Updating Subscription Management repositories.
Unable to <span class="nb">read</span> consumer identity
This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.
メタデータの期限切れの最終確認: 0:00:27 時間前の 2020年08月13日 11時08分15秒 に実施しました。
依存関係が解決しました。
<span class="o">=======================================================================================================================</span>
 パッケージ                              アーキテクチャー   バージョン         リポジトリ                        <span class="nv">サイズ</span>
<span class="o">=======================================================================================================================</span>
Installing:
 stratis-cli                             noarch             1.0.2-1.el8        rhel-dvd-AppStream                 <span class="m">51</span> k
 stratisd                                x86_64             1.0.3-1.el8        rhel-dvd-AppStream                1.2 M
依存関係をインストール中:
 python3-dbus-client-gen                 noarch             0.4-1.el8          rhel-dvd-AppStream                 <span class="m">26</span> k
 python3-dbus-python-client-gen          noarch             0.6-2.el8          rhel-dvd-AppStream                 <span class="m">24</span> k
 python3-dbus-signature-pyparsing        noarch             0.03-2.el8         rhel-dvd-AppStream                 <span class="m">19</span> k
 python3-into-dbus-python                noarch             0.06-2.el8         rhel-dvd-AppStream                 <span class="m">27</span> k
 python3-justbases                       noarch             0.9-6.el8          rhel-dvd-AppStream                 <span class="m">45</span> k
 python3-justbytes                       noarch             0.11-2.el8         rhel-dvd-AppStream                 <span class="m">40</span> k
 python3-pyparsing                       noarch             2.1.10-7.el8       rhel-dvd-BaseOS                   <span class="m">142</span> k

<span class="nv">トランザクションの概要</span>
<span class="o">======================================================================================================================</span>
インストール  <span class="m">9</span> パッケージ

合計サイズ: 1.6 M
インストール済みのサイズ: 5.1 M
これでよろしいですか? <span class="o">[</span>y/N<span class="o">]</span>: y
パッケージのダウンロード中です:
トランザクションの確認を実行中
トランザクションの確認に成功しました。
トランザクションのテストを実行中
トランザクションのテストに成功しました。
トランザクションを実行中
  準備             :                                                             1/1
  Installing       : python3-pyparsing-2.1.10-7.el8.noarch                       1/9
  Installing       : python3-dbus-signature-pyparsing-0.03-2.el8.noarch          2/9
  Installing       : python3-into-dbus-python-0.06-2.el8.noarch                  3/9
  Installing       : python3-dbus-python-client-gen-0.6-2.el8.noarch             4/9
  Installing       : stratisd-1.0.3-1.el8.x86_64                                 5/9
  scriptletの実行中: stratisd-1.0.3-1.el8.x86_64                                 5/9
  Installing       : python3-justbases-0.9-6.el8.noarch                          6/9
  Installing       : python3-justbytes-0.11-2.el8.noarch                         7/9
  Installing       : python3-dbus-client-gen-0.4-1.el8.noarch                    8/9
  Installing       : stratis-cli-1.0.2-1.el8.noarch                              9/9
  scriptletの実行中: stratis-cli-1.0.2-1.el8.noarch                              9/9
  検証             : python3-dbus-client-gen-0.4-1.el8.noarch                    1/9
  検証             : python3-dbus-python-client-gen-0.6-2.el8.noarch             2/9
  検証             : python3-dbus-signature-pyparsing-0.03-2.el8.noarch          3/9
  検証             : python3-into-dbus-python-0.06-2.el8.noarch                  4/9
  検証             : python3-justbases-0.9-6.el8.noarch                          5/9
  検証             : python3-justbytes-0.11-2.el8.noarch                         6/9
  検証             : stratis-cli-1.0.2-1.el8.noarch                              7/9
  検証             : stratisd-1.0.3-1.el8.x86_64                                 8/9
  検証             : python3-pyparsing-2.1.10-7.el8.noarch                       9/9
Installed products updated.

インストール済み:
  stratis-cli-1.0.2-1.el8.noarch                          stratisd-1.0.3-1.el8.x86_64                                python3-dbus-client-gen-0.4-1.el8.noarch
  python3-dbus-python-client-gen-0.6-2.el8.noarch         python3-dbus-signature-pyparsing-0.03-2.el8.noarch         python3-into-dbus-python-0.06-2.el8.noarch
  python3-justbases-0.9-6.el8.noarch                      python3-justbytes-0.11-2.el8.noarch                        python3-pyparsing-2.1.10-7.el8.noarch

完了しました!

<span class="c1"># stratisdサービスを起動する</span>
<span class="c1"># systemctl enable --now stratisd</span>
<span class="c1"># systemctl status stratisd</span>
● stratisd.service - A daemon that manages a pool of block devices to create flexible file systems
   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/stratisd.service<span class="p">;</span> enabled<span class="p">;</span> vendor preset: enabled<span class="o">)</span>
   Active: active <span class="o">(</span>running<span class="o">)</span> since Thu 2020-08-13 14:15:30 EDT<span class="p">;</span> 1s ago
     Docs: man:stratisd<span class="o">(</span>8<span class="o">)</span>
 Main PID: <span class="m">13302</span> <span class="o">(</span>stratisd<span class="o">)</span>
    Tasks: <span class="m">1</span> <span class="o">(</span>limit: 11517<span class="o">)</span>
   Memory: 848.0K
   CGroup: /system.slice/stratisd.service
           └─13302 /usr/libexec/stratisd --debug

Aug <span class="m">13</span> 14:15:30 RHEL8TEST systemd<span class="o">[</span>1<span class="o">]</span>: Started A daemon that manages a pool of block devices to create flexible file systems.
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>: DEBUG libstratis::stratis::buff_log: BuffLogger: pass_through: <span class="nb">true</span> hold time: none
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>:  INFO stratisd: Using StratEngine
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>: DEBUG stratisd: Engine state:
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>: StratEngine <span class="o">{</span>
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>:     pools: <span class="o">{}</span>,
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>:     incomplete_pools: <span class="o">{}</span>,
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>:     watched_dev_last_event_nrs: <span class="o">{}</span>
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>: <span class="o">}</span>
Aug <span class="m">13</span> 14:15:30 RHEL8TEST stratisd<span class="o">[</span>13302<span class="o">]</span>:  INFO stratisd: DBUS API is now available
</code></pre></div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="hl"><span class="lnt">3
</span></span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
<span class="hl">       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Hello&#34;</span><span class="o">);</span>
</span>    <span class="o">}</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>

        </div>
    </article>

                </div>
            </div>
        </main>
        <footer class="m-global-footer">
            <span class="a-copy-right">
    Copyright 2020
    UNCHAIN-ENDO
    All rights reserved.
</span>


        </footer>
    </body>
</html>
